@import com.mohiva.play.silhouette.api.actions.UserAwareRequest
@import silhouette.CookieEnv

@()(implicit request: UserAwareRequest[CookieEnv, AnyContent])

@template.template("カテゴリ管理") {
    <div class="columns">
        <div class="column is-one-quarter">
            <div id="app">
                <aside class="menu">
                    <p class="menu-label">
                        カテゴリ
                    </p>
                    <menu-list v-bind:data="data"></menu-list>
                </aside>
                <router-view></router-view>
            </div>
        </div>
    </div>
    <script>
        const edit = {
            template: `<div>{{ $route.params.id }}</div>`
        }

        const router = new VueRouter({
            mode: "history",
            routes: [
                {
                    name: "edit",
                    path: `@routes.Category.index()/:id/edit`,
                    component: edit
                }
            ]
        })

        Vue.component("menu-list", {
            props: ["data"],
            template: `
                <ul class="menu-list">
                    <menu-list-item v-for="category in data" v-bind:category="category"></menu-list-item>
                </ul>
            `
        })

        Vue.component("menu-list-item", {
            props: ["category"],
            template: `
                <li><router-link :to="{name: 'edit', params: { id: category.id}}">{{ category.name }}</router-link></li>
            `,
            methods: {
            }
        })

        fetch("@routes.Category.list()", {
            credentials: 'include'
        }).then((res) => {return res.json()}).then((json) => {
            const app = new Vue({
                el: "#app",
                data: {
                    data: json
                },
                router
            })
        })
    </script>
}